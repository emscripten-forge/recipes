context:
  name: libheif
  version: 1.21.2

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/strukturag/libheif/releases/download/v${{ version }}/libheif-${{ version }}.tar.gz
  sha256: 75f530b7154bc93e7ecf846edfc0416bf5f490612de8c45983c36385aa742b42
  patches:
  - fix-emscripten-val-set.patch # Fixes error: 'val_set' was not declared in this scope, to remove when https://github.com/strukturag/libheif/pull/1565 is merged

build:
  number: 0

requirements:
  build:
  - ${{ compiler('c') }}
  - ${{ compiler('cxx') }}
  - cmake
  - ninja
  - pkg-config
  host:
  - zlib
  - libtiff
  - libpng

tests:
- package_contents:
    files:
    - include/libheif/heif.h
    - lib/libheif.a

about:
  license: LGPL-3.0-or-later
  license_file: COPYING
  summary: ISO/IEC 23008-12:2017 HEIF and AVIF file format decoder and encoder
  description: |
    libheif is an ISO/IEC 23008-12:2017 HEIF and AVIF (AV1 Image File Format) file format decoder and encoder.
    HEIF and AVIF are new image file formats employing HEVC (H.265) or AV1 image coding, respectively, for the
    best compression ratios currently possible.
  homepage: https://github.com/strukturag/libheif

extra:
  recipe-maintainers:
  - emscripten-forge