context:
  name: openblas-flang
  version: 0.3.31

package:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/OpenMathLib/OpenBLAS/archive/v${{ version }}.tar.gz
  sha256: 6dd2a63ac9d32643b7cc636eab57bf4e57d0ed1fff926dfbc5d3d97f2d2be3a6
  patches:
  # Branch containing these patches is v0.3.30-emforge-4x at https://github.com/ianthomas23/OpenBLAS
  - patches/0001-Remove-march-flags.patch
  - patches/0002-Skip-linktest.patch
  - patches/0003-Add-emscripten-as-supported-arch.patch
  - patches/0004-Add-dummy-length-arguments-for-char-arguments.patch
  - patches/0005-Return-void-not-int.patch
  - patches/0006-Int-to-void-return-types-of-lapack-functions-used-by.patch
  - patches/0007-Enable-LAPACK_FORTRAN_STDLEN_END-for-lapacke-calling.patch
  - patches/0008-Use-openblas-flang-in-pkgconfig-and-cmake-config.patch

build:
  number: 0

requirements:
  build:
  - ${{ compiler('c') }}
  - flang_${{ target_platform }} >= 20.1
  - cmake
  - make
  host:
  - libflang >= 20.1

tests:
- package_contents:
    include:
    - cblas.h
    - f77blas.h
    - lapack.h
    - lapacke.h
    lib:
    - libopenblas-flang.a
    - libopenblas-flang.so
- script: pytester
  files:
    recipe:
    - test_openblas.py
  requirements:
    build:
    - pytester
    run:
    - pytester-run

about:
  homepage: http://www.openblas.net/
  repository: https://github.com/OpenMathLib/OpenBLAS
  license: BSD-3-Clause
  license_file: LICENSE
  summary: An optimized BLAS library based on GotoBLAS2 1.13 BSD version

extra:
  maintainers:
  - DerThorsten
  - anutosh491
  - IsabelParedes
  - ianthomas23
