From a3ff20208c00ab916c92bc8aba42d6ec2ee2fbd2 Mon Sep 17 00:00:00 2001
From: Isabel Paredes <isabel.paredes@quantstack.net>
Date: Mon, 15 Sep 2025 12:41:41 +0200
Subject: [PATCH] Enable emscripten

---
 CMakeLists.txt | 17 ++++++++++++-----
 1 file changed, 12 insertions(+), 5 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 15ceebe..ba5aa64 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -154,9 +154,9 @@ target_include_directories(zlib PUBLIC ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRE
 add_library(zlibstatic STATIC ${ZLIB_SRCS} ${ZLIB_PUBLIC_HDRS} ${ZLIB_PRIVATE_HDRS})
 target_include_directories(zlibstatic PUBLIC ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR})
 set_target_properties(zlib PROPERTIES DEFINE_SYMBOL ZLIB_DLL)
-set_target_properties(zlib PROPERTIES SOVERSION 1)
+# set_target_properties(zlib PROPERTIES SOVERSION 1)
 
-if(NOT CYGWIN)
+if(NOT EMSCRIPTEN)
     # This property causes shared libraries on Linux to have the full version
     # encoded into their final filename.  We disable this on Cygwin because
     # it causes cygz-${ZLIB_FULL_VERSION}.dll to be created when cygz.dll
@@ -169,8 +169,15 @@ endif()
 
 if(UNIX)
     # On unix-like platforms the library is almost always called libz
-   set_target_properties(zlib zlibstatic PROPERTIES OUTPUT_NAME z)
-   if(NOT APPLE AND NOT(CMAKE_SYSTEM_NAME STREQUAL AIX))
+
+   if(NOT EMSCRIPTEN)
+      set_target_properties(zlib zlibstatic PROPERTIES OUTPUT_NAME z)
+   else()
+      set_target_properties(zlib PROPERTIES OUTPUT_NAME z)
+      set_target_properties(zlibstatic PROPERTIES OUTPUT_NAME z)
+   endif()
+
+   if(NOT APPLE)
      set_target_properties(zlib PROPERTIES LINK_FLAGS "-Wl,--version-script,\"${CMAKE_CURRENT_SOURCE_DIR}/zlib.map\"")
    endif()
 elseif(BUILD_SHARED_LIBS AND WIN32)
@@ -215,4 +222,4 @@ if(ZLIB_BUILD_EXAMPLES)
         target_link_libraries(minigzip64 zlib)
         set_target_properties(minigzip64 PROPERTIES COMPILE_FLAGS "-D_FILE_OFFSET_BITS=64")
     endif()
-endif()
+endif()
\ No newline at end of file
