context:
  name: matplotlib
  version: "3.9.1"

source:
- url: https://github.com/matplotlib/matplotlib/archive/v${{ version }}.tar.gz
  sha256: 4fdf46dc325fdf4cbc61f7fa66de7b48287df0a71b3442b63ff0784041cae2e7
  patches:
  - patches/fix-threading-and-font-cache.patch

build:
  number: 0

outputs:
  - package:
      name: matplotlib-base
      version: ${{ version }}
    build:
      script: build-base.sh
    requirements:
      build:
      - python
      - pip
      - cross-python_${{ target_platform }}

      - ${{ compiler('c') }}
      - ${{ compiler('cxx') }}
      - pkg-config
      - meson-python

      - setuptools_scm_git_archive

      # We still need the `numpy` dep in build for cross-compilation
      # We could in theory get around it in the future by using meson cross-file
      # and setting `numpy-include-dir = ...` to the right path. However, we also need
      # to use the right Python headers and that is easiest with `cross-python` right now.
      - numpy

      host:
      - python
      - numpy
      - pybind11
      - freetype
      - qhull

      run:
      - contourpy
      - cycler
      - fonttools
      - kiwisolver
      - numpy
      - packaging
      - pillow
      - pyparsing
      - python-dateutil
      - pytz

  - package:
      name: matplotlib
      version: ${{ version }}

    requirements:
      host:
      - python
      run:
      - python
      - ${{ pin_subpackage('matplotlib-base', exact=True) }}

    tests:
    - script: pytester
      files:
        recipe:
        - test_import_matplotlib.py
      requirements:
        build:
        - pytester
        run:
        - pytester-run
