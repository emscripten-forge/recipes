context:
  version: 2.0.1
  name: pyjs
package:
  name: ${{name}}
  version: ${{ version }}

source:
- path: /Users/thorstenbeier/src/pyjs

build:
  number: 8

requirements:
  build:
  - ${{ compiler("c") }}
  - ${{ compiler("cxx") }}
  - cmake
  - make
  host:
  - python
  - sqlite
  - zlib
  - bzip2
  - libffi
  - pybind11


tests:
  - script: |
      echo "ls"
      ls
      echo "install playwright"
      playwright install
      echo "test in browser (main thread)"
      pyjs_code_runner run script \
          browser-main \
          --conda-env     $PREFIX \
          --mount         $(pwd)/tests:/tests \
          --script        main.py \
          --work-dir      /tests \
          --pyjs-dir      $(pwd)/build \
          --headless \
          --async-main \
          --no-cache

    requirements:
      build:
        - pyjs_code_runner
        - if: linux
          then:
            - playwright < 1.42
        - if: osx
          then: 
            - playwright
      run:
        - pytest
        - numpy
    files:
      recipe:
        - test_regex.py


about:
  license: BSD-3-Clause
  license_family: BSD
  license_file: LICENSE
  summary: pyjs

  homepage: https://github.com/emscripten-forge/pyjs
extra:
  recipe-maintainers:
  - DerThorsten
