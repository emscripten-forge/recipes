context:
  name: "r-base"
  version: 4.4.1

package:
  name: ${{ name }}
  version: ${{ version }}


source:
  url: https://cran.r-project.org/src/base/R-4/R-${{ version }}.tar.gz
  # sha256: 80851231393b85bf3877ee9e39b282e750ed864c5ec60cbd68e6e139f0520330 # 4.3.3
  sha256: b4cb675deaaeb7299d3b265d218cde43f192951ce5b89b7bb1a5148a36b2d94d # 4.4.1
  # sha256: 55e4a9a6d43be314e2c03d0266a6fa5444afdce50b303bfc3b82b3979516e074 # 4.2.3
  patches:
  - patches/00_fix_Rshlibpath_var.patch
  - patches/01_skip_libcurl.patch
  - patches/02_fix_mbcs_support.patch
  - patches/03_fix_tre_headers.patch
  - patches/05_fix_undefined_sigsuspend.patch
  - patches/06_skip_internet.patch
  - patches/07_skip_bad_substitution.patch
  - patches/08_use_R_binary_from_build_prefix.patch
  - patches/09_ignore_crude_heuristic_file_size.patch
  - patches/10_build_docs_with_Rscript.patch
  - patches/11_use_basenames_for_compilers.patch # Just use emcc directly. CC = issues
  # - patches/12_tst_skip_md_rule.patch # REMOVE later
  - patches/13_default_R_home.patch

build:
  number: 11 # TODO: reset later

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - libtool
    - pkg-config
    - cmake
    - make
    - r-base == ${{ version }}  # for R and Rscript binaries (See patches)
  host:
    - liblapack>=3.12 # TODO: replace with blas only package (shared lib?) or OpenBLAS
    # - openblas # FIXME: the check fails, looking for dgemm_
    - libiconv
    - zlib>=1.2.13
    - bzip2
    - xz # for lzma
    - cairo>=1.18
    - pcre2>=10.43
    - tzdata
    - libpng
    - libtiff
    # - icu # FIXME: icu check fails


tests:
- script:
    - test -f $PREFIX/lib/R/bin/exec/R.wasm
    - node $PREFIX/lib/R/bin/exec/R --version
  requirements:
    build:
    - nodejs

about:
  homepage: http://www.r-project.org/
  license: GPL-2.0-or-later
  license_family: GPL
  license_file: COPYING
  summary: R is a free software environment for statistical computing and graphics.

extra:
  recipe-maintainers:
    - IsabelParedes
