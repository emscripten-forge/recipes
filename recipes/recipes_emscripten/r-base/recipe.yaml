context:
  name: "r-base"
  version: 4.4.1

package:
  name: ${{ name }}
  version: ${{ version }}


source:
  url: https://cran.r-project.org/src/base/R-4/R-${{ version }}.tar.gz
  # sha256: 80851231393b85bf3877ee9e39b282e750ed864c5ec60cbd68e6e139f0520330 # 4.3.3
  sha256: b4cb675deaaeb7299d3b265d218cde43f192951ce5b89b7bb1a5148a36b2d94d # 4.4.1
  # sha256: 55e4a9a6d43be314e2c03d0266a6fa5444afdce50b303bfc3b82b3979516e074 # 4.2.3
  patches:
  - patches/00_fix_Rshlibpath_var.patch
  - patches/01_skip_libcurl.patch
  - patches/02_fix_mbcs_support.patch
  - patches/03_fix_tre_headers.patch
  # - patches/04_make_libRblas.patch # Don't need this with SHLIB_EXT
  - patches/05_fix_undefined_sigsuspend.patch
  - patches/06_skip_internet.patch
  - patches/07_skip_bad_substitution.patch
  - patches/08_use_R_binary_from_build_prefix.patch
  - patches/09_ignore_crude_heuristic_file_size.patch
  - patches/10_build_docs_with_Rscript.patch
  - patches/11_use_basenames_for_compilers.patch # Just use emcc directly. CC = issues
  # - patches/12_tst_skip_md_rule.patch # REMOVE later

build:
  number: 7

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - libtool
    - pkg-config
    - cmake
    - make
    - libpng
    - readline
    - zlib
    - bzip2
    - libdeflate
    - xz
    - tzdata
    - libiconv
    - r-base  # for R and Rscript binaries (See patches)
    # TODO: pin r-base version BUT currently incompatible with zlib v1.2
  host:
    - liblapack>=3.12
    - libiconv
    - zlib>=1.2.13
    - bzip2
    - cairo>=0.18
    - pcre2>=10.43
    - xz # for lzma
  run:
    - zlib
    - bzip2

about:
  homepage: http://www.r-project.org/
  license: GPL-2.0-or-later
  license_family: GPL
  license_file: COPYING
  summary: R is a free software environment for statistical computing and graphics.

extra:
  recipe-maintainers:
    - IsabelParedes
