From 5196bfcd66ff000da9190ece2b64a71233826717 Mon Sep 17 00:00:00 2001
From: Ian Thomas <ianthomas23@gmail.com>
Date: Tue, 9 Dec 2025 09:55:21 +0000
Subject: [PATCH 10/15] Change return and char length args in optimize

---
 scipy/optimize/__lbfgsb.c | 16 ++++++++--------
 scipy/optimize/__lbfgsb.h |  6 +++---
 2 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/scipy/optimize/__lbfgsb.c b/scipy/optimize/__lbfgsb.c
index 306f6d66e6..9a31bd8970 100644
--- a/scipy/optimize/__lbfgsb.c
+++ b/scipy/optimize/__lbfgsb.c
@@ -1270,7 +1270,7 @@ bmv(int m, double* sy, double* wt, int col, double* v, double* p, int* info)
 
     // Solve the triangular system
     // dtrtrs(uplo, trans, diag, n, nrhs, a, lda, b, ldb, info)
-    dtrtrs_(uplo, trans, diag, &col, &one_int, wt, &m, &p[col], &col, info);
+    dtrtrs_(uplo, trans, diag, &col, &one_int, wt, &m, &p[col], &col, info, 1, 1, 1);
     if (*info != 0) { return; }
 
     // Solve D^(1/2)p1=v1.
@@ -1286,7 +1286,7 @@ bmv(int m, double* sy, double* wt, int col, double* v, double* p, int* info)
     // solve J^Tp2=p2.
     // dtrtrs(uplo, trans, diag, n, nrhs, a, lda, b, ldb, info)
     trans = "N";
-    dtrtrs_(uplo, trans, diag, &col, &one_int, wt, &m, &p[col], &col, info);
+    dtrtrs_(uplo, trans, diag, &col, &one_int, wt, &m, &p[col], &col, info, 1, 1, 1);
     if (*info != 0) { return; }
 
     // compute p1=-D^(-1/2)(p1-D^(-1/2)L'p2)
@@ -2223,14 +2223,14 @@ formk(int n, int nsub, int* ind, int nenter, int ileave,
     //                      with L' stored in the upper triangle of wn.
 
     // dpotrf(uplo, n, a, lda, info)
-    dpotrf_(uplo, &col, wn, &m2, info);
+    dpotrf_(uplo, &col, wn, &m2, info, 1);
     if (*info != 0) { *info = -1; return; }
 
     // Then form L^-1(-L_a'+R_z') in the (1,2) block.
     col2 = 2*col;
 
     // dtrtrs(uplo, trans, diag, n, nrhs, a, lda, b, ldb, info)
-    dtrtrs_(uplo, trans, diag, &col, &col, wn, &m2, &wn[m2*col], &m2, info);
+    dtrtrs_(uplo, trans, diag, &col, &col, wn, &m2, &wn[m2*col], &m2, info, 1, 1, 1);
 
     // Form S'AA'S*theta + (L^-1(-L_a'+R_z'))'L^-1(-L_a'+R_z') in the upper
     //  triangle of (2,2) block of wn.
@@ -2245,7 +2245,7 @@ formk(int n, int nsub, int* ind, int nenter, int ileave,
     // 72
 
     // dpotrf(uplo, n, a, lda, info)
-    dpotrf_(uplo, &col, &wn[col + m2*col], &m2, info);
+    dpotrf_(uplo, &col, &wn[col + m2*col], &m2, info, 1);
     if (*info != 0) { *info = -2; }
 
     return;
@@ -2312,7 +2312,7 @@ formt(int m, double* wt, double* sy, double* ss, int col,
 
     // Cholesky factorize T to J*J' with J' stored in the upper triangle of wt.
     // dpotrf(uplo, n, a, lda, info)
-    dpotrf_(uplo, &col, wt, &m, info);
+    dpotrf_(uplo, &col, wt, &m, info, 1);
     if (*info != 0) { *info = -3; }
 
     return;
@@ -3025,13 +3025,13 @@ void subsm(int n, int m, int nsub, int* ind,
     col2 = 2*col;
 
     // dtrtrs(uplo, trans, diag, n, nrhs, a, lda, b, ldb, info)
-    dtrtrs_(uplo, trans, diag, &col2, &one_int, wn, &m2, wv, &m2, info);
+    dtrtrs_(uplo, trans, diag, &col2, &one_int, wn, &m2, wv, &m2, info, 1, 1, 1);
     if (*info != 0) { return; }
 
     for (i = 0; i < col; i++) { wv[i] = -wv[i]; }
 
     trans = "N";
-    dtrtrs_(uplo, trans, diag, &col2, &one_int, wn, &m2, wv, &m2, info);
+    dtrtrs_(uplo, trans, diag, &col2, &one_int, wn, &m2, wv, &m2, info, 1, 1, 1);
     if (*info != 0) { return; }
 
     // Compute d = (1/theta)d + (1/theta**2)Z'W wv.
diff --git a/scipy/optimize/__lbfgsb.h b/scipy/optimize/__lbfgsb.h
index 1ac42a4e49..832ba9176f 100644
--- a/scipy/optimize/__lbfgsb.h
+++ b/scipy/optimize/__lbfgsb.h
@@ -21,8 +21,8 @@ double dnrm2_(int* n, double* x, int* incx);
 double ddot_(int* n, double* x, int* incx, double* y, int* incy);
 
 // LAPACK
-void dpotrf_(char* uplo, int* n, double* a, int* lda, int* info);
-void dtrtrs_(char* uplo, char* trans, char* diag, int* n, int* nrhs, double* a, int* lda, double* b, int* ldb, int* info);
+void dpotrf_(char* uplo, int* n, double* a, int* lda, int* info, int);
+void dtrtrs_(char* uplo, char* trans, char* diag, int* n, int* nrhs, double* a, int* lda, double* b, int* ldb, int* info, int, int, int);
 
 static PyObject* lbfgsb_error;
 
@@ -189,4 +189,4 @@ PyInit__lbfgsb(void)
 }  /* extern "C" */
 #endif /* __cplusplus */
 
-#endif /* ifndef */
\ No newline at end of file
+#endif /* ifndef */
-- 
2.51.0

