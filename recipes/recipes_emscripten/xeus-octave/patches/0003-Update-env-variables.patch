From 0eb1e3899b8bdee718a029d26ef5e40126ce3acd Mon Sep 17 00:00:00 2001
From: Isabel Paredes <isabel.paredes@quantstack.net>
Date: Thu, 20 Nov 2025 12:26:48 +0100
Subject: [PATCH 3/3] Update env variables

---
 CMakeLists.txt      |  4 ++++
 wasm/env_vars.js    | 10 ----------
 wasm/env_vars.js.in | 10 ++++++++++
 3 files changed, 14 insertions(+), 10 deletions(-)
 delete mode 100644 wasm/env_vars.js
 create mode 100644 wasm/env_vars.js.in

diff --git a/CMakeLists.txt b/CMakeLists.txt
index d12a41c..e203086 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -96,6 +96,10 @@ if(EMSCRIPTEN)
         "${CMAKE_CURRENT_SOURCE_DIR}/share/jupyter/kernels/xoctave/kernel_wasm.json.in"
         "${CMAKE_CURRENT_SOURCE_DIR}/share/jupyter/kernels/xoctave/kernel.json"
     )
+    configure_file(
+        "${CMAKE_CURRENT_SOURCE_DIR}/wasm/env_vars.js.in"
+        "${CMAKE_CURRENT_SOURCE_DIR}/wasm/env_vars.js"
+    )
 else()
     configure_file(
         "${CMAKE_CURRENT_SOURCE_DIR}/share/jupyter/kernels/xoctave/kernel.json.in"
diff --git a/wasm/env_vars.js b/wasm/env_vars.js
deleted file mode 100644
index 875ae00..0000000
--- a/wasm/env_vars.js
+++ /dev/null
@@ -1,10 +0,0 @@
-Module["onRuntimeInitialized"] = () => {
-    console.log("Octave is ready!");
-}
-
-Module["preRun"] = () => {
-    ENV["OCTAVE_HOME"] = "/";
-    ENV["OCTAVE_PATH"] = "/share/xeus-octave::/share/octave/site/m:/share/octave/site/m/startup:/share/octave/10.2.0/m:/share/octave/10.2.0/m/audio:/share/octave/10.2.0/m/deprecated:/share/octave/10.2.0/m/elfun:/share/octave/10.2.0/m/general:/share/octave/10.2.0/m/geometry:/share/octave/10.2.0/m/gui:/share/octave/10.2.0/m/help:/share/octave/10.2.0/m/image:/share/octave/10.2.0/m/io:/share/octave/10.2.0/m/legacy:/share/octave/10.2.0/m/linear-algebra:/share/octave/10.2.0/m/miscellaneous:/share/octave/10.2.0/m/ode:/share/octave/10.2.0/m/optimization:/share/octave/10.2.0/m/path:/share/octave/10.2.0/m/pkg:/share/octave/10.2.0/m/plot:/share/octave/10.2.0/m/plot/appearance:/share/octave/10.2.0/m/plot/draw:/share/octave/10.2.0/m/plot/util:/share/octave/10.2.0/m/polynomial:/share/octave/10.2.0/m/prefs:/share/octave/10.2.0/m/profiler:/share/octave/10.2.0/m/set:/share/octave/10.2.0/m/signal:/share/octave/10.2.0/m/sparse:/share/octave/10.2.0/m/specfun:/share/octave/10.2.0/m/special-matrix:/share/octave/10.2.0/m/startup:/share/octave/10.2.0/m/statistics:/share/octave/10.2.0/m/strings:/share/octave/10.2.0/m/testfun:/share/octave/10.2.0/m/time:/share/octave/10.2.0/m/web:/share/octave/10.2.0/data";
-    ENV["OCTAVE_BUILT_IN_DOCSTRINGS_FILE"] = "/share/octave/10.2.0/etc/built-in-docstrings";
-    ENV["OCTAVE_TEXI_MACROS_FILE"] = "/share/octave/10.2.0/etc/macros.texi";
-};
diff --git a/wasm/env_vars.js.in b/wasm/env_vars.js.in
new file mode 100644
index 0000000..33beaa4
--- /dev/null
+++ b/wasm/env_vars.js.in
@@ -0,0 +1,10 @@
+Module["onRuntimeInitialized"] = () => {
+    console.log("Octave is ready!");
+}
+
+Module["preRun"] = () => {
+    ENV["OCTAVE_HOME"] = "/";
+    ENV["OCTAVE_PATH"] = "/share/xeus-octave::/share/octave/site/m:/share/octave/site/m/startup:/share/octave/@octinterp_VERSION@/m:/share/octave/@octinterp_VERSION@/m/audio:/share/octave/@octinterp_VERSION@/m/deprecated:/share/octave/@octinterp_VERSION@/m/elfun:/share/octave/@octinterp_VERSION@/m/general:/share/octave/@octinterp_VERSION@/m/geometry:/share/octave/@octinterp_VERSION@/m/gui:/share/octave/@octinterp_VERSION@/m/help:/share/octave/@octinterp_VERSION@/m/image:/share/octave/@octinterp_VERSION@/m/io:/share/octave/@octinterp_VERSION@/m/legacy:/share/octave/@octinterp_VERSION@/m/linear-algebra:/share/octave/@octinterp_VERSION@/m/miscellaneous:/share/octave/@octinterp_VERSION@/m/ode:/share/octave/@octinterp_VERSION@/m/optimization:/share/octave/@octinterp_VERSION@/m/path:/share/octave/@octinterp_VERSION@/m/pkg:/share/octave/@octinterp_VERSION@/m/plot:/share/octave/@octinterp_VERSION@/m/plot/appearance:/share/octave/@octinterp_VERSION@/m/plot/draw:/share/octave/@octinterp_VERSION@/m/plot/util:/share/octave/@octinterp_VERSION@/m/polynomial:/share/octave/@octinterp_VERSION@/m/prefs:/share/octave/@octinterp_VERSION@/m/profiler:/share/octave/@octinterp_VERSION@/m/set:/share/octave/@octinterp_VERSION@/m/signal:/share/octave/@octinterp_VERSION@/m/sparse:/share/octave/@octinterp_VERSION@/m/specfun:/share/octave/@octinterp_VERSION@/m/special-matrix:/share/octave/@octinterp_VERSION@/m/startup:/share/octave/@octinterp_VERSION@/m/statistics:/share/octave/@octinterp_VERSION@/m/strings:/share/octave/@octinterp_VERSION@/m/testfun:/share/octave/@octinterp_VERSION@/m/time:/share/octave/@octinterp_VERSION@/m/web:/share/octave/@octinterp_VERSION@/data";
+    ENV["OCTAVE_BUILT_IN_DOCSTRINGS_FILE"] = "/share/octave/@octinterp_VERSION@/etc/built-in-docstrings";
+    ENV["OCTAVE_TEXI_MACROS_FILE"] = "/share/octave/@octinterp_VERSION@/etc/macros.texi";
+};
