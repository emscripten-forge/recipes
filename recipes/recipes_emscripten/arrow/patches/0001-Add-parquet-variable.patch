From ec9f1a29fb57819974388fd9858b50f0f90c7139 Mon Sep 17 00:00:00 2001
From: Isabel Paredes <isabel.paredes@quantstack.net>
Date: Mon, 2 Feb 2026 18:29:44 +0100
Subject: [PATCH] Add parquet variable

---
 r/src/arrowExports.cpp | 2 +-
 r/src/dataset.cpp      | 7 +++++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/r/src/arrowExports.cpp b/r/src/arrowExports.cpp
index 73bf81f..ca739d6 100644
--- a/r/src/arrowExports.cpp
+++ b/r/src/arrowExports.cpp
@@ -1867,7 +1867,7 @@ extern "C" SEXP _arrow_dataset___FileWriteOptions__type_name(SEXP options_sexp){
 #endif
 
 // dataset.cpp
-#if defined(ARROW_R_WITH_DATASET)
+#if defined(ARROW_R_WITH_DATASET) && defined(ARROW_R_WITH_PARQUET)
 void dataset___ParquetFileWriteOptions__update(const std::shared_ptr<ds::ParquetFileWriteOptions>& options, const std::shared_ptr<parquet::WriterProperties>& writer_props, const std::shared_ptr<parquet::ArrowWriterProperties>& arrow_writer_props);
 extern "C" SEXP _arrow_dataset___ParquetFileWriteOptions__update(SEXP options_sexp, SEXP writer_props_sexp, SEXP arrow_writer_props_sexp){
 BEGIN_CPP11
diff --git a/r/src/dataset.cpp b/r/src/dataset.cpp
index e53fc03..2a47f47 100644
--- a/r/src/dataset.cpp
+++ b/r/src/dataset.cpp
@@ -27,7 +27,10 @@
 #include <arrow/table.h>
 #include <arrow/util/checked_cast.h>
 #include <arrow/util/iterator.h>
+
+#if defined(ARROW_R_WITH_PARQUET)
 #include <parquet/properties.h>
+#endif
 
 namespace ds = ::arrow::dataset;
 namespace fs = ::arrow::fs;
@@ -223,6 +226,7 @@ std::shared_ptr<ds::FileWriteOptions> dataset___FileFormat__DefaultWriteOptions(
   return fmt->DefaultWriteOptions();
 }
 
+#if defined(ARROW_R_WITH_PARQUET)
 // [[dataset::export]]
 std::shared_ptr<ds::ParquetFileFormat> dataset___ParquetFileFormat__Make(
     const std::shared_ptr<ds::ParquetFragmentScanOptions>& options,
@@ -237,6 +241,7 @@ std::shared_ptr<ds::ParquetFileFormat> dataset___ParquetFileFormat__Make(
 
   return fmt;
 }
+#endif
 
 // [[dataset::export]]
 std::string dataset___FileWriteOptions__type_name(
@@ -339,6 +344,7 @@ std::shared_ptr<ds::JsonFragmentScanOptions> dataset___JsonFragmentScanOptions__
   return options;
 }
 
+#if defined(ARROW_R_WITH_PARQUET)
 // [[dataset::export]]
 std::shared_ptr<ds::ParquetFragmentScanOptions>
 dataset___ParquetFragmentScanOptions__Make(bool use_buffered_stream, int64_t buffer_size,
@@ -362,6 +368,7 @@ dataset___ParquetFragmentScanOptions__Make(bool use_buffered_stream, int64_t buf
       thrift_container_size_limit);
   return options;
 }
+#endif
 
 // DirectoryPartitioning, HivePartitioning
 
